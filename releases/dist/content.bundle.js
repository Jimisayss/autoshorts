(()=>{"use strict";var e={};const t="shortsWatchedCount",o="totalTimeWatched",r="manuallySkippedCount";function n(e){try{if("undefined"==typeof chrome||!chrome.storage||!chrome.storage.local)return void console.error("AutoShorts: chrome.storage.local is not available in this context.");chrome.storage.local.get([t,o],r=>{if(chrome.runtime.lastError)return void console.error("AutoShorts: Error reading stats:",chrome.runtime.lastError);const n=Number(r[t])||0,i=Number(r[o])||0;chrome.storage.local.set({[t]:n+1,[o]:i+e},()=>{chrome.runtime.lastError?console.error("AutoShorts: Error updating stats:",chrome.runtime.lastError):console.log("AutoShorts: Stats updated. Count:",n+1,"Time (ms):",i+e)})})}catch(e){console.error("AutoShorts: Exception in updateStats:",e)}}function i(){try{if("undefined"==typeof chrome||!chrome.storage||!chrome.storage.local)return void console.error("AutoShorts: chrome.storage.local is not available in this context.");chrome.storage.local.get([r],e=>{if(chrome.runtime.lastError)return void console.error("AutoShorts: Error reading manual skip:",chrome.runtime.lastError);const t=Number(e[r])||0;chrome.storage.local.set({[r]:t+1},()=>{chrome.runtime.lastError?console.error("AutoShorts: Error updating manual skip:",chrome.runtime.lastError):console.log("AutoShorts: Manual skips updated. Count:",t+1)})})}catch(e){console.error("AutoShorts: Exception in incrementManualSkip:",e)}}function u(){return/^\/shorts\/[A-Za-z0-9_-]+/.test(window.location.pathname)}function a(){let e=document.querySelector("ytd-reel-video-renderer[is-active] video")||document.querySelector("ytd-reel-video-renderer video")||document.querySelector("video.html5-main-video");return e||console.warn("AutoShorts: Video element not found."),e}function c(){let e=document.querySelector('button[aria-label="Next video"]')||document.querySelector('button[aria-label="Next short"]')||document.querySelector('button[aria-label="Next"]')||document.querySelector('#navigation-button > ytd-button-renderer > yt-button-shape > button[aria-label="Next video"]')||document.querySelector('#navigation-button > ytd-button-renderer > yt-button-shape > button[aria-label="Next short"]')||document.querySelector('button[aria-label*="Down"]');return e||console.warn("AutoShorts: Next button not found."),e}function s(e,t=!1){console.log("AutoShorts: Attempting to skip short.");const o=a();o&&(n((e?Date.now()-e:1e3*o.duration)||0),t&&i());const r=c();if(r)console.log("AutoShorts: Clicking 'Next' button.",r),r.click();else{console.warn("AutoShorts: 'Next' button not found, falling back to ArrowDown simulation.");const e=new KeyboardEvent("keydown",{key:"ArrowDown",code:"ArrowDown",keyCode:40,which:40,bubbles:!0,cancelable:!0});window.dispatchEvent(e)}}function l(e,t,o){e&&(e.removeEventListener("playing",t),e.removeEventListener("timeupdate",o))}let d=null,h=null,m=null,w=0;function S(){h=Date.now(),console.log("AutoShorts: Video started playing or resumed. Start time:",h,d)}function p(){d&&d.duration-d.currentTime<=.2&&!d._autoShortsSkipped&&(d._autoShortsSkipped=!0,s(h),n(h?Date.now()-h:1e3*d.duration))}function v(){l(d,S,p)}function b(){if(!u())return void(m&&(v(),d=null,m=null));const e=function(){const e=window.location.pathname.match(/^\/shorts\/([A-Za-z0-9_-]+)/);return e?e[1]:null}();if(e&&e!==m){w&&Date.now()-w<1e3&&(i(),w=0),console.log(`AutoShorts: New short detected (ID: ${e}). Setting up.`),v(),m=e;let t=0;const o=15;function r(){const i=a();if(i){l(d,S,p),i._autoShortsSkipped=!1,i.addEventListener("playing",S),i.addEventListener("timeupdate",p),d=i,i.paused||S();const e=c();e&&e.addEventListener("click",()=>{s(h,!0),n(h?Date.now()-h:1e3*d.duration)},{once:!0}),[document.getElementById("navigation-button-up"),document.getElementById("navigation-button-down")].forEach(e=>{e&&e.addEventListener("click",()=>{s(h,!0),n(h?Date.now()-h:1e3*d.duration)},{once:!0})}),window.addEventListener("keydown",function e(t){"ArrowDown"!==t.key&&"ArrowDown"!==t.code||(s(h,!0),window.removeEventListener("keydown",e))})}else t<o?(t++,l(d,S,p),setTimeout(r,200)):(l(d,S,p),console.warn(`AutoShorts: Short detected (ID: ${e}), but video element not found after retries.`))}r()}}window.addEventListener("wheel",()=>{w=Date.now()},{passive:!0}),function(e,t=200){const o=function(e,t){let o=null;return function(...r){clearTimeout(o),o=setTimeout(()=>e.apply(this,r),t)}}(e,t);new MutationObserver(o).observe(document.body,{childList:!0,subtree:!0}),console.log("AutoShorts: MutationObserver set up with debounce:",t,"ms")}(b,200),b(),chrome.runtime.onMessage.addListener((e,t,o)=>{if(e&&"autoShortsCheck"===e.action){if(console.log("AutoShorts: Received check from background. Page is hidden:",document.hidden),u()){const e=a();e&&e.duration>0&&e.currentTime/e.duration>.95&&(e._autoShortsSkipped||(e._autoShortsSkipped=!0,s(h),n(h?Date.now()-h:1e3*e.duration)))}return b(),o({status:"checked"}),!0}});var f=window;for(var g in e)f[g]=e[g];e.__esModule&&Object.defineProperty(f,"__esModule",{value:!0})})();